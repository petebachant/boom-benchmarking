schema: '2.0'
stages:
  get-ztf-data:
    cmd: bash --noprofile --norc scripts/download-ztf-data.sh
    deps:
    - path: scripts/download-ztf-data.sh
      hash: md5
      md5: f16292f742e6aae215eb634e2e3da0ec
      size: 484
      isexec: true
    outs:
    - path: data/ztf_public_20250614
      hash: md5
      md5: 57a45a392cfcc5c148261ec8238cb639.dir
      size: 15932892200
      nfiles: 210240
    - path: data/ztf_public_20250614.tar.gz
      hash: md5
      md5: 7f63a5975f2643a7780a5fedfe3ce95a
      size: 10260752459
  extract-ned-data:
    cmd: bash --noprofile --norc -c "gunzip -k data/kowalski.NED.json.gz"
    deps:
    - path: data/kowalski.NED.json.gz
      hash: md5
      md5: decd3ed39729067d0990aa299c4f513d
      size: 966995306
    outs:
    - path: data/kowalski.NED.json
      hash: md5
      md5: 39875806dc1306ca9778ee24cb2ec07e
      size: 4060622282
  _check-env-py:
    cmd: calkit check environment --name py
    deps:
    - path: envs/py.txt
      hash: md5
      md5: c01f25a85d38f6b40ae88ccc2dfcae10
      size: 89
    outs:
    - path: .calkit/env-locks/py.txt
      hash: md5
      md5: c860c2f8eef6eb71d9db58536968d1a8
      size: 3692
  create-stage:
    cmd: dvc stage add -n new-stage -f --run --dep README.md echo sup
    deps:
    - path: README.md
      hash: md5
      md5: 69f9822ee55dddfce579e3f09a6dad17
      size: 21
  new-stage:
    cmd: echo sup
    deps:
    - path: README.md
      hash: md5
      md5: 69f9822ee55dddfce579e3f09a6dad17
      size: 21
  _clean-nb-inspect-alert:
    cmd: calkit nb clean "notebooks/inspect-alert.ipynb"
    deps:
    - path: notebooks/inspect-alert.ipynb
      hash: md5
      md5: 9063a45f1e9517655803d2e4401dc2df
      size: 667199
    outs:
    - path: .calkit/notebooks/cleaned/notebooks/inspect-alert.ipynb
      hash: md5
      md5: e3c5db800a8fa84938cd19231f613bcb
      size: 2107
  inspect-alert:
    cmd: calkit nb execute --environment py --no-check --to html "notebooks/inspect-alert.ipynb"
    deps:
    - path: .calkit/env-locks/py.txt
      hash: md5
      md5: c860c2f8eef6eb71d9db58536968d1a8
      size: 3692
    - path: .calkit/notebooks/cleaned/notebooks/inspect-alert.ipynb
      hash: md5
      md5: e3c5db800a8fa84938cd19231f613bcb
      size: 2107
    - path: data/kowalski.NED.json
      hash: md5
      md5: 39875806dc1306ca9778ee24cb2ec07e
      size: 4060622282
    - path: data/ztf_public_20250614
      hash: md5
      md5: 57a45a392cfcc5c148261ec8238cb639.dir
      size: 15932892200
      nfiles: 210240
    outs:
    - path: .calkit/notebooks/executed/notebooks/inspect-alert.ipynb
      hash: md5
      md5: 8299ff9adfed0ffa09827834f0176a79
      size: 668394
  avro-to-docs:
    cmd: calkit xenv -n py -- python ".calkit/notebook-stages/avro-to-docs/script.py"
    deps:
    - path: .calkit/notebook-stages/avro-to-docs/script.py
      hash: md5
      md5: 6c4899e6e1a2c58b421a4fd5a50b130a
      size: 1301
    - path: data/ztf_public_20250614
      hash: md5
      md5: 57a45a392cfcc5c148261ec8238cb639.dir
      size: 15932892200
      nfiles: 210240
    outs:
    - path: .calkit/notebook-stages/avro-to-docs/outs/documents.pickle
      hash: md5
      md5: 1185c6aeb3871469ac454e5591ebe76d
      size: 417351254
  _clean-nb-benchmark-mongo:
    cmd: calkit nb clean "notebooks/benchmark-mongo.ipynb"
    deps:
    - path: notebooks/benchmark-mongo.ipynb
      hash: md5
      md5: 8540dab1ddbb9af67fc7a45bfbb677fa
      size: 8066
    outs:
    - path: .calkit/notebooks/cleaned/notebooks/benchmark-mongo.ipynb
      hash: md5
      md5: 7ba988ba34ee1d20260093d0a3e6fdb3
      size: 7247
  benchmark-mongo:
    cmd: calkit nb execute --environment py --no-check --to html "notebooks/benchmark-mongo.ipynb"
    deps:
    - path: .calkit/env-locks/py.txt
      hash: md5
      md5: c860c2f8eef6eb71d9db58536968d1a8
      size: 3692
    - path: .calkit/notebooks/cleaned/notebooks/benchmark-mongo.ipynb
      hash: md5
      md5: 7ba988ba34ee1d20260093d0a3e6fdb3
      size: 7247
    - path: docker-compose.yaml
      hash: md5
      md5: da705e5e38df81d6a1e696f861a30cf2
      size: 575
    outs:
    - path: .calkit/notebooks/executed/notebooks/benchmark-mongo.ipynb
      hash: md5
      md5: d4c4db215bc9cc927a73b2682a1f98e3
      size: 47009
    - path: results/mongo.json
      hash: md5
      md5: 279203c61846e9016c9f003ae720fe5c
      size: 108
  _clean-nb-benchmark-pg:
    cmd: calkit nb clean "notebooks/benchmark-pg.ipynb"
    deps:
    - path: notebooks/benchmark-pg.ipynb
      hash: md5
      md5: f2c8a4b742d08e5d45b3dc1ec981a12c
      size: 8215
    outs:
    - path: .calkit/notebooks/cleaned/notebooks/benchmark-pg.ipynb
      hash: md5
      md5: f2c8a4b742d08e5d45b3dc1ec981a12c
      size: 8215
  ztf-avro-to-pg-rows:
    cmd: calkit xenv -n py -- python ".calkit/notebook-stages/ztf-avro-to-pg-rows/script.py"
    deps:
    - path: .calkit/notebook-stages/ztf-avro-to-pg-rows/script.py
      hash: md5
      md5: 44f68e6af9bea88d602fc16bba67bd60
      size: 989
    - path: data/ztf_public_20250614
      hash: md5
      md5: 57a45a392cfcc5c148261ec8238cb639.dir
      size: 15932892200
      nfiles: 210240
    outs:
    - path: .calkit/notebook-stages/ztf-avro-to-pg-rows/outs/rows.pickle
      hash: md5
      md5: 55805da0cc6b0f827ccc106b5d451745
      size: 415669103
  benchmark-pg:
    cmd: calkit nb execute --environment py --no-check --to html "notebooks/benchmark-pg.ipynb"
    deps:
    - path: .calkit/env-locks/py.txt
      hash: md5
      md5: c860c2f8eef6eb71d9db58536968d1a8
      size: 3692
    - path: .calkit/notebooks/cleaned/notebooks/benchmark-pg.ipynb
      hash: md5
      md5: f2c8a4b742d08e5d45b3dc1ec981a12c
      size: 8215
    - path: docker-compose.yaml
      hash: md5
      md5: da705e5e38df81d6a1e696f861a30cf2
      size: 575
    - path: envs/Dockerfile.pg-q3c
      hash: md5
      md5: e8d2e31cd30ae9c56cd46f471ecca167
      size: 542
    outs:
    - path: .calkit/notebooks/executed/notebooks/benchmark-pg.ipynb
      hash: md5
      md5: 516403705b3042f4c539264916317f03
      size: 14874
    - path: results/postgres.json
      hash: md5
      md5: 825c746ab68d119a24f389364dadaaea
      size: 54
  ztf-avro-to-mongo-docs:
    cmd: calkit xenv -n py -- python ".calkit/notebook-stages/ztf-avro-to-mongo-docs/script.py"
    deps:
    - path: .calkit/notebook-stages/ztf-avro-to-mongo-docs/script.py
      hash: md5
      md5: f78c6b69c087e97eebefe0d624d51c78
      size: 1311
    - path: data/ztf_public_20250614
      hash: md5
      md5: 57a45a392cfcc5c148261ec8238cb639.dir
      size: 15932892200
      nfiles: 210240
    outs:
    - path: .calkit/notebook-stages/ztf-avro-to-mongo-docs/outs/documents.pickle
      hash: md5
      md5: 1185c6aeb3871469ac454e5591ebe76d
      size: 417351254
  _clean-nb-summarize:
    cmd: calkit nb clean "notebooks/summarize.ipynb"
    deps:
    - path: notebooks/summarize.ipynb
      hash: md5
      md5: ee59d338cdf52decc1235788f2dd4de7
      size: 241
    outs:
    - path: .calkit/notebooks/cleaned/notebooks/summarize.ipynb
      hash: md5
      md5: ee59d338cdf52decc1235788f2dd4de7
      size: 241
  summarize:
    cmd: calkit nb execute --environment py --no-check --to html "notebooks/summarize.ipynb"
    deps:
    - path: .calkit/env-locks/py.txt
      hash: md5
      md5: c860c2f8eef6eb71d9db58536968d1a8
      size: 3692
    - path: .calkit/notebooks/cleaned/notebooks/summarize.ipynb
      hash: md5
      md5: ee59d338cdf52decc1235788f2dd4de7
      size: 241
    - path: results/mongo.json
      hash: md5
      md5: 279203c61846e9016c9f003ae720fe5c
      size: 108
    - path: results/postgres.json
      hash: md5
      md5: 825c746ab68d119a24f389364dadaaea
      size: 54
    outs:
    - path: .calkit/notebooks/executed/notebooks/summarize.ipynb
      hash: md5
      md5: 0a4bf0456d09892c0b547edd63ea3102
      size: 463
