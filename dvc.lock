schema: '2.0'
stages:
  get-ztf-data:
    cmd: bash --noprofile --norc scripts/download-ztf-data.sh
    deps:
    - path: scripts/download-ztf-data.sh
      hash: md5
      md5: f16292f742e6aae215eb634e2e3da0ec
      size: 484
      isexec: true
    outs:
    - path: data/ztf_public_20250614
      hash: md5
      md5: 57a45a392cfcc5c148261ec8238cb639.dir
      size: 15932892200
      nfiles: 210240
    - path: data/ztf_public_20250614.tar.gz
      hash: md5
      md5: 7f63a5975f2643a7780a5fedfe3ce95a
      size: 10260752459
  extract-ned-data:
    cmd: bash --noprofile --norc -c "gunzip -k data/kowalski.NED.json.gz"
    deps:
    - path: data/kowalski.NED.json.gz
      hash: md5
      md5: decd3ed39729067d0990aa299c4f513d
      size: 966995306
    outs:
    - path: data/kowalski.NED.json
      hash: md5
      md5: 39875806dc1306ca9778ee24cb2ec07e
      size: 4060622282
  _check-env-py:
    cmd: calkit check environment --name py
    deps:
    - path: envs/py.txt
      hash: md5
      md5: 432a8a72d806322c757d8ccb3c0a2af3
      size: 89
    outs:
    - path: .calkit/env-locks/py.txt
      hash: md5
      md5: bab12a5bfb233b4d236875e41bf1dbd8
      size: 3678
  create-stage:
    cmd: dvc stage add -n new-stage -f --run --dep README.md echo sup
    deps:
    - path: README.md
      hash: md5
      md5: 69f9822ee55dddfce579e3f09a6dad17
      size: 21
  new-stage:
    cmd: echo sup
    deps:
    - path: README.md
      hash: md5
      md5: 69f9822ee55dddfce579e3f09a6dad17
      size: 21
  _clean-nb-inspect-alert:
    cmd: calkit nb clean "notebooks/inspect-alert.ipynb"
    deps:
    - path: notebooks/inspect-alert.ipynb
      hash: md5
      md5: 1ac8c0da8a2bff0d0fc53ffa8390d332
      size: 2767
    outs:
    - path: .calkit/notebooks/cleaned/notebooks/inspect-alert.ipynb
      hash: md5
      md5: 1ac8c0da8a2bff0d0fc53ffa8390d332
      size: 2767
  inspect-alert:
    cmd: calkit nb execute --environment py --no-check --to html "notebooks/inspect-alert.ipynb"
    deps:
    - path: .calkit/env-locks/py.txt
      hash: md5
      md5: bab12a5bfb233b4d236875e41bf1dbd8
      size: 3678
    - path: .calkit/notebooks/cleaned/notebooks/inspect-alert.ipynb
      hash: md5
      md5: 1ac8c0da8a2bff0d0fc53ffa8390d332
      size: 2767
    - path: data/kowalski.NED.json
      hash: md5
      md5: 39875806dc1306ca9778ee24cb2ec07e
      size: 4060622282
    - path: data/ztf_public_20250614
      hash: md5
      md5: 57a45a392cfcc5c148261ec8238cb639.dir
      size: 15932892200
      nfiles: 210240
    outs:
    - path: .calkit/notebooks/executed/notebooks/inspect-alert.ipynb
      hash: md5
      md5: 278fe26ddb4d35f9a8310784eb53c927
      size: 2403959
    - path: .calkit/notebooks/html/notebooks/inspect-alert.html
      hash: md5
      md5: f72a092f0ca3059a37361a6a718328e8
      size: 4563543
  avro-to-docs:
    cmd: calkit xenv -n py -- python ".calkit/notebook-stages/avro-to-docs/script.py"
    deps:
    - path: .calkit/notebook-stages/avro-to-docs/script.py
      hash: md5
      md5: 6c4899e6e1a2c58b421a4fd5a50b130a
      size: 1301
    - path: data/ztf_public_20250614
      hash: md5
      md5: 57a45a392cfcc5c148261ec8238cb639.dir
      size: 15932892200
      nfiles: 210240
    outs:
    - path: .calkit/notebook-stages/avro-to-docs/outs/documents.pickle
      hash: md5
      md5: 1185c6aeb3871469ac454e5591ebe76d
      size: 417351254
  _clean-nb-benchmark-mongo:
    cmd: calkit nb clean "notebooks/benchmark-mongo.ipynb"
    deps:
    - path: notebooks/benchmark-mongo.ipynb
      hash: md5
      md5: b6bea23d323dd3218168c220c45d10f9
      size: 10741
    outs:
    - path: .calkit/notebooks/cleaned/notebooks/benchmark-mongo.ipynb
      hash: md5
      md5: fb8098a1c0d3c2aabe995e6b4b6bf7e1
      size: 7860
  benchmark-mongo:
    cmd: calkit nb execute --environment py --no-check --to html "notebooks/benchmark-mongo.ipynb"
    deps:
    - path: .calkit/env-locks/py.txt
      hash: md5
      md5: bab12a5bfb233b4d236875e41bf1dbd8
      size: 3678
    - path: .calkit/notebooks/cleaned/notebooks/benchmark-mongo.ipynb
      hash: md5
      md5: fb8098a1c0d3c2aabe995e6b4b6bf7e1
      size: 7860
    - path: docker-compose.mongo.yaml
      hash: md5
      md5: 359151b4e283a06f76167f5b91c6a9d0
      size: 257
    outs:
    - path: .calkit/notebooks/executed/notebooks/benchmark-mongo.ipynb
      hash: md5
      md5: 36229c3ab34dc926c599ffdca8b754ce
      size: 35912
    - path: .calkit/notebooks/html/notebooks/benchmark-mongo.html
      hash: md5
      md5: 756d9a461436eeb23562b35d3ce639c4
      size: 323829
    - path: results/mongo.json
      hash: md5
      md5: bf1e3604e35c13c6b9da1067c910dd78
      size: 352
  _clean-nb-benchmark-pg:
    cmd: calkit nb clean "notebooks/benchmark-pg.ipynb"
    deps:
    - path: notebooks/benchmark-pg.ipynb
      hash: md5
      md5: 016e1e4e6201dfbb7e10d9b157f0d09b
      size: 9671
    outs:
    - path: .calkit/notebooks/cleaned/notebooks/benchmark-pg.ipynb
      hash: md5
      md5: 016e1e4e6201dfbb7e10d9b157f0d09b
      size: 9671
  ztf-avro-to-pg-rows:
    cmd: calkit xenv -n py -- python ".calkit/notebook-stages/ztf-avro-to-pg-rows/script.py"
    deps:
    - path: .calkit/notebook-stages/ztf-avro-to-pg-rows/script.py
      hash: md5
      md5: 44f68e6af9bea88d602fc16bba67bd60
      size: 989
    - path: data/ztf_public_20250614
      hash: md5
      md5: 57a45a392cfcc5c148261ec8238cb639.dir
      size: 15932892200
      nfiles: 210240
    outs:
    - path: .calkit/notebook-stages/ztf-avro-to-pg-rows/outs/rows.pickle
      hash: md5
      md5: 55805da0cc6b0f827ccc106b5d451745
      size: 415669103
  benchmark-pg:
    cmd: calkit nb execute --environment py --no-check --to html "notebooks/benchmark-pg.ipynb"
    deps:
    - path: .calkit/env-locks/py.txt
      hash: md5
      md5: bab12a5bfb233b4d236875e41bf1dbd8
      size: 3678
    - path: .calkit/notebooks/cleaned/notebooks/benchmark-pg.ipynb
      hash: md5
      md5: 016e1e4e6201dfbb7e10d9b157f0d09b
      size: 9671
    - path: docker-compose.postgres.yaml
      hash: md5
      md5: 941effb0961e731c4393ee384ffd0a44
      size: 273
    - path: envs/Dockerfile.pg-q3c
      hash: md5
      md5: e8d2e31cd30ae9c56cd46f471ecca167
      size: 542
    - path: envs/init-q3c.sql
      hash: md5
      md5: b0cf0ab5723364628957cc878da1a786
      size: 36
    outs:
    - path: .calkit/notebooks/executed/notebooks/benchmark-pg.ipynb
      hash: md5
      md5: 11be7d2211e93fa354635826f8e496d2
      size: 156214
    - path: .calkit/notebooks/html/notebooks/benchmark-pg.html
      hash: md5
      md5: 2a02cf5d22ef9b6095a0629c3f9e38d0
      size: 449208
    - path: results/postgres.json
      hash: md5
      md5: 8622e88098339b5a145e3bd46240260f
      size: 349
  ztf-avro-to-mongo-docs:
    cmd: calkit xenv -n py -- python ".calkit/notebook-stages/ztf-avro-to-mongo-docs/script.py"
    deps:
    - path: .calkit/notebook-stages/ztf-avro-to-mongo-docs/script.py
      hash: md5
      md5: f78c6b69c087e97eebefe0d624d51c78
      size: 1311
    - path: data/ztf_public_20250614
      hash: md5
      md5: 57a45a392cfcc5c148261ec8238cb639.dir
      size: 15932892200
      nfiles: 210240
    outs:
    - path: .calkit/notebook-stages/ztf-avro-to-mongo-docs/outs/documents.pickle
      hash: md5
      md5: 1185c6aeb3871469ac454e5591ebe76d
      size: 417351254
  _clean-nb-summarize:
    cmd: calkit nb clean "notebooks/summarize.ipynb"
    deps:
    - path: notebooks/summarize.ipynb
      hash: md5
      md5: 32f1c9ee33abb5cb786f7b1a3ebaa921
      size: 4166
    outs:
    - path: .calkit/notebooks/cleaned/notebooks/summarize.ipynb
      hash: md5
      md5: ba66d978b22bd534b7a2e07b7689f247
      size: 1702
  summarize:
    cmd: calkit nb execute --environment analyze --no-check --to html "notebooks/summarize.ipynb"
    deps:
    - path: .calkit/env-locks/analyze.txt
      hash: md5
      md5: 23927583902ddc3d14e09fd2cd7f07b8
      size: 944
    - path: .calkit/notebooks/cleaned/notebooks/summarize.ipynb
      hash: md5
      md5: ba66d978b22bd534b7a2e07b7689f247
      size: 1702
    - path: results/mongo.json
      hash: md5
      md5: bf1e3604e35c13c6b9da1067c910dd78
      size: 352
    - path: results/postgres.json
      hash: md5
      md5: 8622e88098339b5a145e3bd46240260f
      size: 349
    outs:
    - path: .calkit/notebooks/executed/notebooks/summarize.ipynb
      hash: md5
      md5: 3f28f8e2968b17ba1ea81b86499850d9
      size: 4689
    - path: .calkit/notebooks/html/notebooks/summarize.html
      hash: md5
      md5: b3f596445cb6459f60783de884ec9631
      size: 274848
  _check-env-duckdb:
    cmd: calkit check environment --name duckdb
    deps:
    - path: envs/duckdb.txt
      hash: md5
      md5: f4c56f21823fc67b492d5c38cd0de10a
      size: 17
    outs:
    - path: .calkit/env-locks/duckdb.txt
      hash: md5
      md5: a5135c13860f51d9e4c8c7b235590629
      size: 547
  _check-env-analyze:
    cmd: calkit check environment --name analyze
    deps:
    - path: envs/analyze.txt
      hash: md5
      md5: 5447ba5d0b03f3922b102c43ef202365
      size: 61
    outs:
    - path: .calkit/env-locks/analyze.txt
      hash: md5
      md5: 23927583902ddc3d14e09fd2cd7f07b8
      size: 944
